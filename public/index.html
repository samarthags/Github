<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your GitHub Wrapped</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');

    /* Reset */
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -o-user-select: none;
    }

    /* Input & Button */
    #usernameInput {
      width: 90vw;
      max-width: 400px;
      padding: 16px 20px;
      font-size: 1.3rem;
      border-radius: 14px;
      border: none;
      outline: none;
      margin-bottom: 20px;
      background: #21262d;
      color: #c9d1d9;
      transition: background 0.3s ease;
    }
    #usernameInput:focus {
      background: #30363d;
    }

    #startBtn {
      width: 90vw;
      max-width: 400px;
      background: #238636;
      border: none;
      padding: 16px 0;
      font-weight: 700;
      font-size: 1.3rem;
      border-radius: 14px;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-bottom: 30px;
      user-select: none;
    }
    #startBtn:hover:not(:disabled) {
      background: #2ea043;
    }
    #startBtn:disabled {
      background: #444c56;
      cursor: not-allowed;
    }

    /* Loading text */
    #loading {
      font-size: 1.2rem;
      color: #8b949e;
      min-height: 1.5em;
      margin-bottom: 20px;
    }

    /* Wrapped Screen */
    #wrappedScreen {
      display: none;
      flex-direction: column;
      align-items: center;
      max-width: 700px;
      width: 90vw;
      padding: 0 15px;
    }

    /* Top small avatar + name */
    #topInfo {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 40px;
      user-select: none;
    }

    #avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      border: 3px solid #30363d;
      box-shadow: 0 0 12px rgba(35,134,54,0.7);
      flex-shrink: 0;
    }

    #usernameGreeting {
      font-size: 1.8rem;
      font-weight: 700;
      color: #58a6ff;
      white-space: nowrap;
    }

    /* Main wrapped text */
    #storyText {
      font-size: 2.8rem;
      font-weight: 700;
      color: #fff;
      max-width: 100%;
      min-height: 10rem;
      line-height: 1.2;
      cursor: pointer;
      user-select: none;
      opacity: 0;
      transform: translateX(40px);
      transition: opacity 0.8s ease, transform 0.8s ease;
      text-shadow: 0 0 8px rgba(88,166,255,0.7);
      margin-bottom: 15px;
    }

    #storyText.visible {
      opacity: 1;
      transform: translateX(0);
    }

    /* Tap helper */
    #tapHelper {
      font-size: 1rem;
      color: #8b949e;
      font-weight: 500;
      margin-bottom: 40px;
      font-style: italic;
      user-select: none;
    }

    /* Footer */
    footer {
      margin-top: auto;
      padding: 20px 10px;
      font-size: 1rem;
      color: #8b949e;
      user-select: none;
    }

    footer a {
      color: #58a6ff;
      text-decoration: none;
      font-weight: 600;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 450px) {
      #storyText {
        font-size: 2rem;
        min-height: 8rem;
      }
      #usernameGreeting {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <input id="usernameInput" type="text" placeholder="Enter your GitHub username" autocomplete="off" />
  <button id="startBtn">Show My GitHub Wrapped</button>
  <div id="loading"></div>

  <div id="wrappedScreen" aria-live="polite" aria-atomic="true">
    <div id="topInfo">
      <img id="avatar" src="" alt="User avatar" />
      <div id="usernameGreeting"></div>
    </div>

    <div id="storyText" title="Tap or click to see next stat" tabindex="0" role="button" aria-pressed="false"></div>
    <div id="tapHelper">Tap or click the text to see more stats</div>
  </div>

  <footer>
    made with ðŸ’œ by <a href="https://samarthags.in" target="_blank" rel="noopener noreferrer">Samartha gs</a>
  </footer>

<script>
  const startBtn = document.getElementById('startBtn');
  const usernameInput = document.getElementById('usernameInput');
  const loadingDiv = document.getElementById('loading');
  const wrappedScreen = document.getElementById('wrappedScreen');
  const avatarImg = document.getElementById('avatar');
  const usernameGreeting = document.getElementById('usernameGreeting');
  const storyText = document.getElementById('storyText');
  const tapHelper = document.getElementById('tapHelper');

  let stats = [];
  let currentIndex = 0;
  let autoAdvanceTimeout = null;
  let isAnimating = false;

  function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  async function showStory(index) {
    if (isAnimating) return;
    isAnimating = true;

    storyText.classList.remove('visible');
    await sleep(800);

    storyText.innerHTML = stats[index];
    storyText.classList.add('visible');
    isAnimating = false;

    resetAutoAdvance();
  }

  function resetAutoAdvance() {
    if (autoAdvanceTimeout) clearTimeout(autoAdvanceTimeout);
    autoAdvanceTimeout = setTimeout(() => {
      currentIndex = (currentIndex + 1) % stats.length;
      showStory(currentIndex);
    }, 8000);
  }

  async function startWrapped() {
    const username = usernameInput.value.trim();
    if (!username) {
      alert('Please enter your GitHub username.');
      return;
    }

    loadingDiv.textContent = 'Fetching your GitHub Wrapped...';
    startBtn.disabled = true;
    usernameInput.disabled = true;

    try {
      const res = await fetch(`/api/loc?username=${encodeURIComponent(username)}`);
      if (!res.ok) throw new Error('User not found or API error.');
      const data = await res.json();

      stats = [
        `Hey <strong>${data.name || username}</strong>, did you know you've written <strong>${data.totalLOC.toLocaleString()}</strong> lines of code? Thatâ€™s a mountain of creativity!`,
        `You made <strong>${data.commitsCount.toLocaleString()}</strong> commits in total â€” your dedication is inspiring.`,
        data.commitStreak
          ? `Your longest commit streak was <strong>${data.commitStreak} days</strong>. Keep that momentum going!`
          : `Commit streak data is not available.`,
        `You've earned <strong>${data.totalStars.toLocaleString()}</strong> stars from the community. Shine on!`,
        `Your favorite language is <strong>${data.favoriteLanguage}</strong>, and it suits you perfectly.`,
        data.biggestRepo
          ? `Your largest repo is <strong>${data.biggestRepo.name}</strong> with <strong>${data.biggestRepo.loc.toLocaleString()}</strong> lines of code. Impressive!`
          : `No repository data to show here.`,
        `You code mostly on <strong>${data.mostActiveDay}</strong>. Thatâ€™s your prime time!`,
        data.codingMood
          ? `Looks like your coding mood is <strong>${data.codingMood}</strong>. Stay inspired!`
          : `Coding mood data is unavailable.`,
        data.mostCommonCommit
          ? `Your most common commit message starts with "<strong>${data.mostCommonCommit}</strong>". A true signature!`
          : `No common commit message data found.`
      ];

      // Show wrapped screen
      usernameInput.style.display = 'none';
      startBtn.style.display = 'none';
      loadingDiv.style.display = 'none';
      wrappedScreen.style.display = 'flex';

      avatarImg.src = data.avatar;
      avatarImg.alt = `${data.name || username}'s avatar`;
      usernameGreeting.textContent = `Hey ${data.name || username}`;

      // Show first stat
      currentIndex = 0;
      await showStory(currentIndex);

      // Focus for accessibility so user can tab to storyText
      storyText.focus();

    } catch (error) {
      loadingDiv.textContent = error.message;
      startBtn.disabled = false;
      usernameInput.disabled = false;
    }
  }

  storyText.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % stats.length;
    showStory(currentIndex);
  });

  storyText.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      currentIndex = (currentIndex + 1) % stats.length;
      showStory(currentIndex);
    }
  });

  startBtn.addEventListener('click', startWrapped);
  usernameInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') startWrapped();
  });
</script>

</body>
</html>