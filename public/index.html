<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Wrapped</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6e40c9;
      --primary-light: #8a63d2;
      --text: #2d3748;
      --text-light: #4a5568;
      --bg: #f7fafc;
      --card-bg: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
      line-height: 1.5;
    }

    .container {
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 10px;
      font-weight: 700;
    }

    .subtitle {
      color: var(--text-light);
      font-weight: 300;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    input {
      padding: 15px 20px;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius);
      font-size: 1rem;
      transition: all 0.2s ease;
      background-color: var(--card-bg);
      box-shadow: var(--shadow);
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(110, 64, 201, 0.2);
    }

    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 15px;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: var(--shadow);
    }

    button:hover {
      background-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    button:disabled {
      background-color: #a0aec0;
      cursor: not-allowed;
      transform: none;
      box-shadow: var(--shadow);
    }

    .loading-container {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(110, 64, 201, 0.2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--text-light);
      font-size: 1.1rem;
      text-align: center;
    }

    .wrapped-container {
      display: none;
      flex-direction: column;
      gap: 20px;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid white;
      box-shadow: var(--shadow);
    }

    .profile-info h2 {
      color: var(--primary);
      font-size: 1.5rem;
    }

    .profile-info p {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .stat-card {
      background-color: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    .stat-card h3 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .stat-card p {
      color: var(--text-light);
    }

    .stat-card strong {
      color: var(--primary);
      font-weight: 700;
    }

    .progress-dots {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #e2e8f0;
      transition: all 0.2s ease;
    }

    .dot.active {
      background-color: var(--primary);
      transform: scale(1.2);
    }

    footer {
      text-align: center;
      margin-top: 40px;
      color: var(--text-light);
      font-size: 0.9rem;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.8rem;
      }

      .stat-card h3 {
        font-size: 1.5rem;
      }

      .avatar {
        width: 60px;
        height: 60px;
      }

      .profile-info h2 {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>GitHub Wrapped</h1>
      <p class="subtitle">Your annual GitHub coding statistics</p>
    </header>

    <div class="input-group">
      <input type="text" id="usernameInput" placeholder="Enter your GitHub username">
      <button id="fetchButton">Get My Wrapped</button>
    </div>

    <div class="loading-container" id="loadingContainer">
      <div class="spinner"></div>
      <p class="loading-text" id="loadingText">Fetching your GitHub data...</p>
    </div>

    <div class="wrapped-container" id="wrappedContainer">
      <div class="profile-header">
        <img id="userAvatar" class="avatar" src="" alt="User avatar">
        <div class="profile-info">
          <h2 id="userName"></h2>
          <p id="joinDate"></p>
        </div>
      </div>

      <div class="stat-card" id="statCard">
        <h3 id="statTitle">Your GitHub Wrapped</h3>
        <p id="statDescription">Tap to see your stats</p>
      </div>

      <div class="progress-dots" id="progressDots"></div>
    </div>

    <footer>
      Made with ❤️ by <a href="https://samarthags.in" target="_blank">Samartha GS</a>
    </footer>
  </div>

  <script>
    const usernameInput = document.getElementById('usernameInput');
    const fetchButton = document.getElementById('fetchButton');
    const loadingContainer = document.getElementById('loadingContainer');
    const loadingText = document.getElementById('loadingText');
    const wrappedContainer = document.getElementById('wrappedContainer');
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    const joinDate = document.getElementById('joinDate');
    const statCard = document.getElementById('statCard');
    const statTitle = document.getElementById('statTitle');
    const statDescription = document.getElementById('statDescription');
    const progressDots = document.getElementById('progressDots');

    let stats = [];
    let currentStatIndex = 0;
    let userData = null;
    let autoAdvanceTimer = null;

    const loadingMessages = [
      "Fetching your GitHub profile...",
      "Analyzing your repositories...",
      "Counting your lines of code...",
      "Calculating your commit stats...",
      "Almost there...",
      "Preparing your Wrapped..."
    ];

    function updateLoadingMessage(index) {
      loadingText.textContent = loadingMessages[index % loadingMessages.length];
    }

    async function fetchGitHubData(username) {
      try {
        loadingContainer.style.display = 'flex';
        fetchButton.disabled = true;
        usernameInput.disabled = true;

        // Show loading messages in sequence
        let loadingIndex = 0;
        const loadingInterval = setInterval(() => {
          updateLoadingMessage(loadingIndex);
          loadingIndex++;
        }, 2000);

        const response = await fetch(`/api/loc?username=${encodeURIComponent(username)}`);
        if (!response.ok) {
          throw new Error(await response.text());
        }

        clearInterval(loadingInterval);
        return await response.json();
      } catch (error) {
        throw error;
      } finally {
        loadingContainer.style.display = 'none';
      }
    }

    function createStats(data) {
      return [
        {
          title: `Welcome, ${data.name || data.login}`,
          description: `You joined GitHub on <strong>${data.joined}</strong> and have <strong>${data.repoCount}</strong> repositories.`
        },
        {
          title: "Code Mastery",
          description: `You've written approximately <strong>${data.totalLOC.toLocaleString()}</strong> lines of code across all your projects.`
        },
        {
          title: "Commit Champion",
          description: `You've made <strong>${data.commitsCount.toLocaleString()}</strong> commits with your longest streak being <strong>${data.commitStreak}</strong> days.`
        },
        {
          title: "Star Collector",
          description: `Your repositories have earned <strong>${data.totalStars.toLocaleString()}</strong> stars from the community.`
        },
        {
          title: "Language Expert",
          description: `Your most used language is <strong>${data.favoriteLanguage}</strong>.`
        },
        data.biggestRepo ? {
          title: "Biggest Project",
          description: `Your largest repository is <strong>${data.biggestRepo.name}</strong> with <strong>${data.biggestRepo.loc.toLocaleString()}</strong> lines of code.`
        } : null,
        {
          title: "Coding Rhythm",
          description: `Your most active day is <strong>${data.mostActiveDay}</strong>.`
        },
        {
          title: "Coding Mood",
          description: `You're a <strong>${data.codingMood.toLowerCase()}</strong>.`
        },
        {
          title: "Commit Style",
          description: `Your most common commit message starts with "<strong>${data.mostCommonCommit}</strong>".`
        }
      ].filter(Boolean);
    }

    function showStat(index) {
      if (index < 0 || index >= stats.length) return;
      
      currentStatIndex = index;
      const stat = stats[index];
      
      statTitle.textContent = stat.title;
      statDescription.innerHTML = stat.description;
      
      // Update progress dots
      updateProgressDots();
      
      // Reset auto-advance timer
      resetAutoAdvance();
    }

    function updateProgressDots() {
      progressDots.innerHTML = '';
      for (let i = 0; i < stats.length; i++) {
        const dot = document.createElement('div');
        dot.className = 'dot';
        if (i === currentStatIndex) {
          dot.classList.add('active');
        }
        progressDots.appendChild(dot);
      }
    }

    function resetAutoAdvance() {
      if (autoAdvanceTimer) clearTimeout(autoAdvanceTimer);
      autoAdvanceTimer = setTimeout(() => {
        nextStat();
      }, 8000);
    }

    function nextStat() {
      const nextIndex = (currentStatIndex + 1) % stats.length;
      showStat(nextIndex);
    }

    function prevStat() {
      const prevIndex = (currentStatIndex - 1 + stats.length) % stats.length;
      showStat(prevIndex);
    }

    async function handleFetch() {
      const username = usernameInput.value.trim();
      if (!username) {
        alert('Please enter a GitHub username');
        return;
      }

      try {
        userData = await fetchGitHubData(username);
        stats = createStats(userData);
        
        // Display user profile
        userAvatar.src = userData.avatar;
        userAvatar.alt = `${userData.name || username}'s avatar`;
        userName.textContent = userData.name || username;
        joinDate.textContent = `Joined GitHub on ${userData.joined}`;
        
        // Show wrapped container
        wrappedContainer.style.display = 'flex';
        
        // Show first stat
        showStat(0);
      } catch (error) {
        console.error('Error:', error);
        alert(`Error: ${error.message}`);
        fetchButton.disabled = false;
        usernameInput.disabled = false;
      }
    }

    // Event listeners
    fetchButton.addEventListener('click', handleFetch);
    usernameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') handleFetch();
    });
    
    statCard.addEventListener('click', nextStat);
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (wrappedContainer.style.display === 'flex') {
        if (e.key === 'ArrowRight') nextStat();
        if (e.key === 'ArrowLeft') prevStat();
      }
    });

    // Initialize
    updateProgressDots();
  </script>
</body>
</html>