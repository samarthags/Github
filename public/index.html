<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Your GitHub Wrapped</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');

  html, body {
    margin: 0; padding: 0;
    height: 100%;
    background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
    color: #c9d1d9;
    font-family: 'Poppins', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    flex-direction: column;
    text-align: center;
    user-select: none;
    -webkit-user-select: none;
  }

  input[type="text"] {
    width: 90vw;
    max-width: 360px;
    padding: 15px 20px;
    font-size: 1.2rem;
    border-radius: 12px;
    border: none;
    outline: none;
    margin-bottom: 20px;
    background: #21262d;
    color: #c9d1d9;
    transition: background 0.3s ease;
  }
  input[type="text"]:focus {
    background: #30363d;
  }

  button {
    background: #238636;
    border: none;
    padding: 15px 30px;
    color: white;
    font-weight: 700;
    font-size: 1.2rem;
    border-radius: 12px;
    cursor: pointer;
    width: 90vw;
    max-width: 360px;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover {
    background: #2ea043;
  }
  button:disabled {
    background: #444c56;
    cursor: not-allowed;
  }

  #loading {
    margin-top: 20px;
    font-size: 1.1rem;
    color: #8b949e;
    min-height: 1.5em;
  }

  #wrappedScreen {
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 0 20px;
    max-width: 600px;
  }

  #avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 3px solid #30363d;
    margin-bottom: 20px;
    box-shadow: 0 0 15px rgba(35,134,54,0.6);
    user-select: none;
  }

  #welcomeText {
    font-size: 2.4rem;
    font-weight: 700;
    margin-bottom: 30px;
    line-height: 1.1;
  }

  #storyText {
    font-size: 1.5rem;
    line-height: 1.4;
    max-width: 90vw;
    color: #58a6ff;
    cursor: pointer;
    user-select: none;
    min-height: 6em;
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  #storyText.fadeOut {
    opacity: 0;
    transform: translateX(-30px);
  }

  #storyText.fadeIn {
    opacity: 1;
    transform: translateX(0);
  }

  /* Responsive tweaks */
  @media (max-width: 400px) {
    #welcomeText {
      font-size: 1.8rem;
    }
    #storyText {
      font-size: 1.2rem;
      min-height: 5em;
    }
  }
</style>
</head>
<body>

  <input type="text" id="usernameInput" placeholder="Enter your GitHub username" autocomplete="off" />
  <button id="startBtn">Show My GitHub Wrapped</button>
  <div id="loading"></div>

  <div id="wrappedScreen">
    <img id="avatar" src="" alt="User Avatar" />
    <div id="welcomeText"></div>
    <div id="storyText" title="Tap to see next"></div>
  </div>

<script>
  const startBtn = document.getElementById('startBtn');
  const usernameInput = document.getElementById('usernameInput');
  const loadingDiv = document.getElementById('loading');
  const wrappedScreen = document.getElementById('wrappedScreen');
  const avatarImg = document.getElementById('avatar');
  const welcomeText = document.getElementById('welcomeText');
  const storyText = document.getElementById('storyText');

  let stats = [];
  let currentIndex = 0;
  let isAnimating = false;

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function showStory(index) {
    if (isAnimating) return;
    isAnimating = true;

    storyText.classList.add('fadeOut');
    await sleep(600);

    storyText.innerHTML = stats[index];
    
    storyText.classList.remove('fadeOut');
    storyText.classList.add('fadeIn');

    await sleep(600);
    storyText.classList.remove('fadeIn');
    isAnimating = false;
  }

  async function startWrapped() {
    const username = usernameInput.value.trim();
    if (!username) {
      alert('Please enter your GitHub username.');
      return;
    }

    loadingDiv.textContent = 'Fetching your GitHub Wrapped...';
    startBtn.disabled = true;
    usernameInput.disabled = true;

    try {
      const res = await fetch(`/api/loc?username=${encodeURIComponent(username)}`);
      if (!res.ok) throw new Error('User not found or API error.');
      const data = await res.json();

      stats = [
        `Hey <strong>${data.name || username}</strong>, did you know you've written <strong>${data.totalLOC.toLocaleString()}</strong> lines of code? That’s a mountain of creativity!`,
        `You made <strong>${data.commitsCount.toLocaleString()}</strong> commits in total — your dedication is inspiring.`,
        data.commitStreak
          ? `Your longest commit streak was <strong>${data.commitStreak} days</strong>. Keep that momentum going!`
          : `Commit streak data is not available.`,
        `You've earned <strong>${data.totalStars.toLocaleString()}</strong> stars from the community. Shine on!`,
        `Your favorite language is <strong>${data.favoriteLanguage}</strong>, and it suits you perfectly.`,
        data.biggestRepo
          ? `Your largest repo is <strong>${data.biggestRepo.name}</strong> with <strong>${data.biggestRepo.loc.toLocaleString()}</strong> lines of code. Impressive!`
          : `No repository data to show here.`,
        `You code mostly on <strong>${data.mostActiveDay}</strong>. That’s your prime time!`,
        data.codingMood
          ? `Looks like your coding mood is <strong>${data.codingMood}</strong>. Stay inspired!`
          : `Coding mood data is unavailable.`,
        data.mostCommonCommit
          ? `Your most common commit message starts with "<strong>${data.mostCommonCommit}</strong>". A true signature!`
          : `No common commit message data found.`
      ];

      // Show wrapped screen
      usernameInput.style.display = 'none';
      startBtn.style.display = 'none';
      loadingDiv.style.display = 'none';
      wrappedScreen.style.display = 'flex';

      // Show avatar and welcome
      avatarImg.src = data.avatar;
      welcomeText.textContent = `Hi there, ${data.name || username}!`;

      // Show first story text
      currentIndex = 0;
      await showStory(currentIndex);

    } catch (error) {
      loadingDiv.textContent = error.message;
      startBtn.disabled = false;
      usernameInput.disabled = false;
    }
  }

  storyText.addEventListener('click', () => {
    if (stats.length === 0) return;
    currentIndex = (currentIndex + 1) % stats.length;
    showStory(currentIndex);
  });

  startBtn.addEventListener('click', startWrapped);
  usernameInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') startWrapped();
  });
</script>

</body>
</html>